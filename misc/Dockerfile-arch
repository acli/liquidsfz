FROM archlinux

RUN pacman -Syu --noconfirm
RUN pacman -S gcc --noconfirm
RUN pacman -S clang --noconfirm
RUN pacman -S make --noconfirm
RUN pacman -S automake --noconfirm
RUN pacman -S autoconf --noconfirm
RUN pacman -S libtool --noconfirm
RUN pacman -S pkg-config --noconfirm
RUN pacman -S jack --noconfirm
RUN pacman -S libsndfile --noconfirm
RUN pacman -S lv2 --noconfirm
RUN pacman -S lv2lint --noconfirm

ADD . /liquidsfz
WORKDIR /liquidsfz

########## Build / Test with gcc
ENV CC=gcc CXX=g++
RUN $CXX --version
RUN ./autogen.sh
RUN make -j `nproc` V=1
RUN make -j `nproc` check
RUN make install
RUN lv2lint http://spectmorph.org/plugins/liquidsfz

########## Cleanup

RUN make uninstall
RUN make distclean

########## Build / Test with clang

ENV CC=clang CXX=clang++
RUN $CXX --version
RUN ./autogen.sh
RUN make -j `nproc` V=1
RUN make -j `nproc` check
RUN make install
RUN lv2lint http://spectmorph.org/plugins/liquidsfz
